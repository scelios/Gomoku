# Checklist projet Gomoku — priorisé

1) Critiques — crashs / mémoire
- [ ] Corriger l'itération / free retournée par getCoordinatesOfNRow (ne pas avancer le pointeur original avant free)
- [ ] Ajouter et utiliser in_bounds(x,y,n) partout avant accès board[y][x]
- [ ] Vérifier toutes les allocations / frees (free de la même adresse allouée)
- [ ] Valider les pointeurs passés aux callbacks (ne pas passer &windows si callback attend windows*)

2) Capture / règle de jeu
- [ ] checkPieceCapture pure : prototype (game, windows, lx, ly), analyser uniquement à partir du dernier coup
- [ ] Marquer (marked array) puis supprimer pour éviter conflits entre directions
- [ ] Ne jamais supprimer la pierre posée (selon règle) ou protéger-la explicitement
- [ ] Mettre à jour score par paire et déclencher windows->changed
- [ ] Tests : capture simple, captures multiples, chevauchement, bord

3) checkVictoryCondition / 5-en-rang
- [ ] Remplacer la boucle actuelle qui avance un pointeur invalide
- [ ] Rendre getN5InARow/getCoordinatesOfNRow pures (passer board en param)
- [ ] Centraliser la décision game_over après captures et coups IA

4) Refacto & lisibilité
- [ ] Découper en helpers (validate_params, mark_captures_from_move, apply_captures_and_update_score, etc.)
- [ ] Normaliser convention coordonnées (board[y][x], drawSquare(x,y)) et documenter
- [ ] Initialiser tous les champs (last_move_set, ia_timer.elapsed, text_img = NULL, board_size...)

5) Affichage / alignement / resize
- [ ] Utiliser drawable area = width - ml - mr, height - mt - mb partout
- [ ] Calculer cell_w/cell_h en float et arrondir pour aligner lignes/centres
- [ ] safe_put_pixel protège des écritures hors image
- [ ] Au resize : mlx_delete_image anciennes images (img, text_img) -> NULL -> mlx_new_image -> mlx_image_to_window

6) Input / souris
- [ ] cell_x = floor((x - ml) * board_size / drawable_w), cell_y = floor((y - mt) * board_size / drawable_h)
- [ ] Ignorer clics hors rectangle drawable
- [ ] Utiliser mêmes marges pour cadrillage et conversion souris→case

7) Texte / timer
- [ ] Conserver pointer text_img, supprimer avant mlx_put_string
- [ ] Timer : stocker elapsed en double (secondes) + start_ts (clock_gettime MONOTONIC)
- [ ] Afficher texte dans la marge (BOARD_MARGIN_LEFT / TOP) pour éviter chevauchement

8) Docker / sécurité
- [ ] Ne pas committer .docker.xauth / .Xauthority ; ajouter .gitignore
- [ ] Documenter génération /tmp/.docker.xauth et montage docker-compose

9) Tests & debugging
- [ ] Ajouter logs debug pour positions testées / marquées / supprimées
- [ ] Tests manuels : resize extrême, alignement clic après resize, captures simples/multiples, règles de protection de la dernière pierre
- [ ] (Optionnel) écrire tests unitaires pour logique capture et detection 5-en-rang

10) Nettoyage final
- [ ] Corriger warnings de compilation (unused vars, prototypes)
- [ ] Exécuter valgrind / ASAN pour détecter accès hors borne et free invalide
- [ ] Documenter invariants et conventions dans README